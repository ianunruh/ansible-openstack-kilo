- include: configure_keystone.yml
  when: glance_configure_keystone
  tags:
    - glance

- include: configure_mysql.yml
  when: glance_configure_mysql
  tags:
    - glance

- include: configure_rabbitmq.yml
  when: glance_configure_rabbitmq
  tags:
    - glance

- name: install glance
  apt:
    pkg: glance
    state: present
  tags:
    - glance
    - glance-install

- name: configure glance-api
  template:
    src: glance-api.conf.j2
    dest: /etc/glance/glance-api.conf
  notify:
    - sync glance db
    - restart glance-api
  tags:
    - glance
    - glance-configure

- name: configure glance-registry
  template:
    src: glance-registry.conf.j2
    dest: /etc/glance/glance-registry.conf
  notify:
    - restart glance-registry
  tags:
    - glance
    - glance-configure

- meta: flush_handlers

- name: ensure sqlite db absent
  file:
    path: /var/lib/glance/glance.sqlite
    state: absent
  tags:
    - glance
