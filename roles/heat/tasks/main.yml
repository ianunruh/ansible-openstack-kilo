- name: install heat-common
  apt:
    pkg: heat-common
    state: present
  tags:
    - heat
    - heat-install

- include: component_api.yml
  when: heat_component_api
  tags:
    - heat

- include: component_api_cfn.yml
  when: heat_component_api_cfn
  tags:
    - heat

- include: component_engine.yml
  when: heat_component_engine
  tags:
    - heat

- name: configure heat
  template:
    src: heat.conf.j2
    dest: /etc/heat/heat.conf
  notify:
    - sync heat db
    - restart heat-api
    - restart heat-api-cfn
    - restart heat-engine
  tags:
    - heat
    - heat-configure

- meta: flush_handlers

- name: ensure sqlite db absent
  file:
    path: /var/lib/heat/heat.sqlite
    state: absent
  tags:
    - heat
